<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IP Logger</title>
</head>
<body>
    <h1>Private IP Logger Demo</h1>
    <p>Fetching IP address...</p>

    <script>
        async function logPrivateIP() {
            const pc = new RTCPeerConnection();
            pc.createDataChannel('');  // Create an empty data channel
            pc.createOffer().then(offer => pc.setLocalDescription(offer));  // Initiate offer

            pc.onicecandidate = event => {
                if (event && event.candidate) {
                    const candidate = event.candidate.candidate;
                    if (candidate.includes("candidate")) {
                        const localIP = candidate.split(" ")[4];  // Extract IP from ICE candidate
                        console.log("Local IP:", localIP);

                        // Send IP to the Vercel serverless function
                        fetch('/api/log', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ ip: localIP })
                        }).then(response => {
                            if (response.ok) {
                                console.log('IP logged successfully');
                            } else {
                                console.error('Failed to log IP');
                            }
                        }).catch(error => {
                            console.error('Error:', error);
                        });
                    }
                }
            };
        }

        logPrivateIP();
    </script>
</body>
</html>
